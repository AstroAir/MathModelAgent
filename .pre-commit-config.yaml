# Pre-commit configuration for MathModelAgent
# See https://pre-commit.com for more information
# See https://pre-commit.com/hooks.html for more hooks

repos:
  # General file checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      # General file formatting
      - id: trailing-whitespace
        args: [--markdown-linebreak-ext=md]
      - id: end-of-file-fixer
      - id: check-yaml
        args: [--allow-multiple-documents]
      - id: check-json
      - id: check-toml
      - id: check-xml
      - id: check-merge-conflict
      - id: check-case-conflict
      - id: check-symlinks
      - id: check-added-large-files
        args: [--maxkb=1000]
      - id: check-executables-have-shebangs
      - id: check-shebang-scripts-are-executable
      # Python specific
      - id: check-ast
      - id: check-builtin-literals
      - id: check-docstring-first
      - id: debug-statements
      - id: name-tests-test
        args: [--pytest-test-first]

  # Python backend checks using Ruff (replaces Black, isort, flake8)
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.9.10
    hooks:
      # Linter
      - id: ruff
        args: [--fix, --exit-non-zero-on-fix]
        files: ^backend/
      # Formatter
      - id: ruff-format
        files: ^backend/

  # Python security scanning
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.10
    hooks:
      - id: bandit
        args: [-r, backend/app]
        files: ^backend/
        pass_filenames: false

  # Python type checking
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.13.0
    hooks:
      - id: mypy
        files: ^backend/
        additional_dependencies: [
          types-requests,
          types-redis,
          types-setuptools,
          pydantic,
          lxml
        ]
        args: [--ignore-missing-imports, --no-strict-optional, --config-file=mypy.ini]
        stages: [manual]

  # Python docstring validation
  - repo: https://github.com/PyCQA/pydocstyle
    rev: 6.3.0
    hooks:
      - id: pydocstyle
        files: ^backend/
        args: [--convention=google, --add-ignore=D100,D101,D102,D103,D104,D105]
        stages: [manual]

  # Frontend checks using Biome (replaces Prettier + ESLint for JS/TS)
  - repo: https://github.com/biomejs/pre-commit
    rev: v0.6.0
    hooks:
      - id: biome-check
        files: ^frontend/
        additional_dependencies: ["@biomejs/biome@1.9.4"]
        stages: [manual]

  # TypeScript type checking (commented out for initial setup)
  # - repo: local
  #   hooks:
  #     - id: vue-tsc
  #       name: Vue TypeScript Check
  #       entry: bash -c 'cd frontend && pnpm vue-tsc --noEmit'
  #       language: system
  #       files: ^frontend/.*\.(vue|ts|js)$
  #       pass_filenames: false

  # Additional hooks (commented out for initial setup - uncomment as needed)
  # Docker file linting
  # - repo: https://github.com/hadolint/hadolint
  #   rev: v2.12.0
  #   hooks:
  #     - id: hadolint-docker
  #       args: [--ignore, DL3008, --ignore, DL3009]

  # YAML linting
  # - repo: https://github.com/adrienverge/yamllint
  #   rev: v1.35.1
  #   hooks:
  #     - id: yamllint
  #       args: [-d, relaxed]

  # Markdown linting
  # - repo: https://github.com/igorshubovych/markdownlint-cli
  #   rev: v0.42.0
  #   hooks:
  #     - id: markdownlint
  #       args: [--fix]

  # Shell script linting
  # - repo: https://github.com/shellcheck-py/shellcheck-py
  #   rev: v0.10.0.1
  #   hooks:
  #     - id: shellcheck

  # Commit message validation
  # - repo: https://github.com/compilerla/conventional-pre-commit
  #   rev: v3.6.0
  #   hooks:
  #     - id: conventional-pre-commit
  #       stages: [commit-msg]

# Configuration
default_stages: [commit]
fail_fast: true

# CI configuration
ci:
  autofix_commit_msg: |
    [pre-commit.ci] auto fixes from pre-commit.com hooks

    for more information, see https://pre-commit.ci
  autofix_prs: true
  autoupdate_branch: ''
  autoupdate_commit_msg: '[pre-commit.ci] pre-commit autoupdate'
  autoupdate_schedule: weekly
  skip: []
  submodules: false
