# API - ä»»åŠ¡å†å²æ¥å£

> **æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
> **æœ€åæ›´æ–°**: 2025-01-17

è¿™äº›æ¥å£ç”¨äºç®¡ç†å’Œæ£€ç´¢å·²æ‰§è¡Œæˆ–æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å†å²è®°å½•ã€‚

**Base Path**: `/history/tasks`

## æ¥å£åˆ—è¡¨

-   `GET /history/tasks`: è·å–ä»»åŠ¡å†å²è®°å½•åˆ—è¡¨ã€‚
-   `GET /history/tasks/{task_id}`: è·å–å•ä¸ªä»»åŠ¡çš„è¯¦ç»†ä¿¡æ¯ã€‚
-   `PUT /history/tasks/{task_id}`: æ›´æ–°ä»»åŠ¡ä¿¡æ¯ã€‚
-   `DELETE /history/tasks/{task_id}`: åˆ é™¤ä¸€ä¸ªä»»åŠ¡ã€‚
-   `POST /history/tasks/{task_id}/pin`: æ”¶è—æˆ–å–æ¶ˆæ”¶è—ä¸€ä¸ªä»»åŠ¡ã€‚

---

### `GET /history/tasks`

**æè¿°**: è·å–ä»»åŠ¡å†å²è®°å½•åˆ—è¡¨ï¼Œæ”¯æŒç­›é€‰ã€‚

**æŸ¥è¯¢å‚æ•°**:

-   `task_type` (string, optional): æŒ‰ä»»åŠ¡ç±»å‹ç­›é€‰ã€‚å…è®¸çš„å€¼: `"custom"`, `"example"`ã€‚
-   `pinned_only` (boolean, optional): å¦‚æœä¸º `true`ï¼Œåˆ™ä»…è¿”å›å·²æ”¶è—çš„ä»»åŠ¡ã€‚é»˜è®¤ä¸º `false`ã€‚

**æˆåŠŸå“åº” (`200 OK`)**:

```json
{
  "total": 2,
  "tasks": [
    {
      "task_id": "20250117-153000-a1b2c3d4",
      "title": "è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ä»»åŠ¡çš„æ ‡é¢˜...",
      "description": "è¿™æ˜¯é—®é¢˜çš„ç®€çŸ­æè¿°...",
      "task_type": "custom",
      "comp_template": "CHINA",
      "status": "completed",
      "file_count": 5,
      "pinned": true,
      "created_at": "2025-01-17T15:30:00Z",
      "updated_at": "2025-01-17T16:00:00Z"
    },
    {
      "task_id": "20250117-153500-e5f6g7h8",
      "title": "è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»»åŠ¡çš„æ ‡é¢˜...",
      "description": "è¿™æ˜¯ç¤ºä¾‹é—®é¢˜çš„ç®€çŸ­æè¿°...",
      "task_type": "example",
      "comp_template": "AMERICAN",
      "status": "processing",
      "file_count": 2,
      "pinned": false,
      "created_at": "2025-01-17T15:35:00Z",
      "updated_at": "2025-01-17T15:40:00Z"
    }
  ]
}
```

---

### `GET /history/tasks/{task_id}`

**æè¿°**: è·å–æŒ‡å®š `task_id` çš„å•ä¸ªä»»åŠ¡çš„è¯¦ç»†ä¿¡æ¯ã€‚

**è·¯å¾„å‚æ•°**:
-   `task_id` (string, required): ä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚

**æˆåŠŸå“åº” (`200 OK`)**:

```json
{
  "task_id": "20250117-153000-a1b2c3d4",
  "title": "è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ä»»åŠ¡çš„æ ‡é¢˜...",
  "description": "è¿™æ˜¯é—®é¢˜çš„ç®€çŸ­æè¿°...",
  "task_type": "custom",
  "comp_template": "CHINA",
  "status": "completed",
  "file_count": 5,
  "pinned": true,
  "created_at": "2025-01-17T15:30:00Z",
  "updated_at": "2025-01-17T16:00:00Z"
}
```

**é”™è¯¯å“åº”**:
-   `404 Not Found`: å¦‚æœ `task_id` ä¸å­˜åœ¨ã€‚

---

### `PUT /history/tasks/{task_id}`

**æè¿°**: æ›´æ–°ä¸€ä¸ªå†å²ä»»åŠ¡çš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ ‡é¢˜æˆ–æè¿°ã€‚æ³¨æ„ï¼šæ­¤æ¥å£ç›®å‰ä¸»è¦ä¾›åç«¯å†…éƒ¨ä½¿ç”¨ï¼Œå‰ç«¯ç•Œé¢æš‚æœªæä¾›ç›´æ¥ç¼–è¾‘åŠŸèƒ½ã€‚

**è·¯å¾„å‚æ•°**:
-   `task_id` (string, required): ä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚

**è¯·æ±‚ä½“ (JSON)**:

```json
{
  "title": "æ›´æ–°åçš„ä»»åŠ¡æ ‡é¢˜",
  "description": "æ›´æ–°åçš„ä»»åŠ¡æè¿°ã€‚"
}
```

**æˆåŠŸå“åº” (`200 OK`)**:

```json
{
  "success": true,
  "message": "ä»»åŠ¡æ›´æ–°æˆåŠŸ"
}
```

**é”™è¯¯å“åº”**:
-   `404 Not Found`: å¦‚æœ `task_id` ä¸å­˜åœ¨ã€‚

---

### `DELETE /history/tasks/{task_id}`

**æè¿°**: åˆ é™¤ä¸€ä¸ªå†å²ä»»åŠ¡åŠå…¶å…³è”çš„æ‰€æœ‰æ–‡ä»¶ã€‚

> **è­¦å‘Š**: è¿™æ˜¯ä¸€ä¸ªç ´åæ€§æ“ä½œï¼Œå°†æ°¸ä¹…åˆ é™¤ä»»åŠ¡è®°å½•å’Œæ‰€æœ‰å·¥ä½œåŒºæ–‡ä»¶ï¼Œæ— æ³•æ¢å¤ã€‚

**è·¯å¾„å‚æ•°**:
-   `task_id` (string, required): ä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚

**æˆåŠŸå“åº” (`200 OK`)**:

```json
{
  "success": true,
  "message": "ä»»åŠ¡åˆ é™¤æˆåŠŸ"
}
```

**é”™è¯¯å“åº”**:
-   `404 Not Found`: å¦‚æœ `task_id` ä¸å­˜åœ¨ã€‚

---

### `POST /history/tasks/{task_id}/pin`

**æè¿°**: æ”¶è—ï¼ˆPinï¼‰æˆ–å–æ¶ˆæ”¶è—ä¸€ä¸ªä»»åŠ¡ã€‚

**è·¯å¾„å‚æ•°**:
-   `task_id` (string, required): ä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚

**è¯·æ±‚ä½“ (JSON)**:

```json
{
  "pinned": true
}
```
-   `pinned` (boolean, required): `true` è¡¨ç¤ºæ”¶è—, `false` è¡¨ç¤ºå–æ¶ˆæ”¶è—ã€‚

**æˆåŠŸå“åº” (`200 OK`)**:

```json
{
  "success": true,
  "pinned": true
}
```

**é”™è¯¯å“åº”**:
-   `404 Not Found`: å¦‚æœ `task_id` ä¸å­˜åœ¨ã€‚

## ğŸ“š ç›¸å…³æ–‡æ¡£

-   [API æ¦‚è§ˆ](overview.md)
-   [æŒ‡å— - ä»»åŠ¡ç®¡ç†](../guides/task-management.md)

---

**ä¸Šä¸€é¡µ**: [æ–‡ä»¶ç®¡ç†æ¥å£](files.md)  
**ä¸‹ä¸€é¡µ**: [WebSocket æ¥å£](websocket.md)
