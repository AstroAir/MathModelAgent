# 任务管理指南

> **文档版本**: v2.0  
> **最后更新**: 2025-01-17  
> **预计阅读时间**: 10 分钟

本指南将帮助您有效地管理、查看和组织您的数学建模任务。

## 📋 功能概述

MathModelAgent 提供了一个完整的任务历史记录系统，让您可以轻松追踪每一个建模项目。

-   **自动记录**: 所有任务（自定义或示例）都会被自动保存。
-   **实时状态**: 任务状态（处理中、已完成、失败）会实时更新。
-   **分类筛选**: 按类型或收藏状态快速找到任务。
-   **任务操作**: 支持收藏、删除、刷新等操作。
-   **详细信息**: 一目了然地查看任务的关键信息。

## 🚀 如何使用任务历史

### 1. 查看历史记录

-   在 Web 界面的左侧边栏，点击 **"历史"** 图标或展开侧边栏即可看到任务列表。
-   列表会按创建时间倒序排列，最新的任务在最上面。

### 2. 筛选任务

侧边栏顶部提供四个筛选按钮：

-   **全部**: 显示所有历史任务。
-   **收藏**: 仅显示您已收藏（pin）的任务。
-   **自定义**: 仅显示您自己创建的任务。
-   **示例**: 仅显示您运行过的内置示例任务。

### 3. 收藏（Pin）任务

对于重要的任务，您可以使用收藏功能将其置顶。

1.  将鼠标悬停在任务卡片上。
2.  点击出现的 **Pin (图钉) 图标**。
3.  收藏后的任务会有一个黄色的图钉标记，并始终显示在列表顶部（按时间排序）。
4.  再次点击图钉图标可以取消收藏。

![任务收藏功能](../images/history-pin.png)  
*（请在此处添加任务收藏功能的截图）*

### 4. 查看任务详情

每个任务卡片都提供了丰富的信息：

-   **标题**: 根据您的问题描述自动生成。
-   **描述**: 问题描述的摘要。
-   **状态图标**:
    -   `⏳` (处理中)
    -   `✅` (已完成)
    -   `❌` (失败)
-   **文件数量**: 任务关联的文件总数。
-   **创建时间**: 智能显示的相对时间（如“5分钟前”、“昨天”）。

点击任务卡片，将加载并跳转到该任务的详细结果页面。

### 5. 删除任务

如果您不再需要某个任务，可以将其删除。

1.  将鼠标悬停在任务卡片上。
2.  点击出现的 **更多 (⋮) 图标**。
3.  选择 **"删除"**。
4.  在弹出的确认对话框中再次确认。

> **警告**: 删除任务会同时删除其工作目录下的所有文件（包括代码、论文、图表和您上传的数据）。此操作不可恢复！

### 6. 刷新列表

-   点击筛选按钮旁边的 **刷新图标**，可以手动从服务器获取最新的任务列表和状态。

## 📊 任务详情页

点击任何一个历史任务，都会进入该任务的详情页，您可以在这里：

-   查看和下载生成的**论文**。
-   查看和复制代码**执行过程**。
-   查看和管理所有**文件**。
-   查看任务的 **Token 使用和成本**统计。

## ⚙️ 技术实现

### 后端

-   **数据模型**: `backend/app/models/task_history.py` 定义了 `TaskHistoryItem` 数据结构。
-   **API**: `backend/app/routers/history_router.py` 提供了完整的 RESTful API 用于任务的增删改查。
-   **数据存储**: 历史记录默认以 JSON 格式持久化存储在 `backend/project/work_dir/task_history.json` 文件中。
-   **并发控制**: 使用文件锁来防止并发写入冲突。

### 前端

-   **UI 组件**: 主要逻辑在 `frontend/src/components/AppSidebar.vue` 中实现。
-   **状态管理**: 使用 Pinia store (`frontend/src/stores/history.ts`) 管理历史记录数据。
-   **API 调用**: `frontend/src/apis/historyApi.ts` 封装了所有与历史记录相关的 API 请求。

## 💡 最佳实践

-   **及时收藏**: 对于重要的建模结果，及时使用收藏功能，方便日后查找。
-   **定期清理**: 定期删除不再需要的测试任务，保持历史记录的整洁。
-   **备份数据**: 如果您使用本地部署，建议定期备份 `backend/project/work_dir/` 目录，以防数据丢失。

## ❓ 常见问题

### Q: 任务状态长时间不更新怎么办？

**A**:
1.  首先尝试点击刷新按钮。
2.  如果仍然不更新，请检查后端服务是否正常运行，以及 Redis 连接是否正常。
3.  查看后端日志 (`backend/logs/app.log`) 是否有相关错误信息。

### Q: 我可以修改历史任务的标题或描述吗？

**A**: 当前版本的前端界面暂不支持直接编辑。但您可以通过调用 `PUT /history/tasks/{task_id}` API 来实现。未来的版本计划在界面上支持此功能。

### Q: 历史记录存储在哪里？可以换成数据库吗？

**A**: 默认存储在 `backend/project/work_dir/task_history.json`。如果您希望使用数据库（如 SQLite, PostgreSQL），可以修改 `backend/app/models/task_history.py` 中的 `TaskHistoryManager` 类，替换其读写方法以对接您的数据库。

## 📚 相关文档

-   [API 参考 - 任务历史](../api/history.md)
-   [第一个建模任务](../getting-started/first-task.md)
-   [开发文档 - 代码结构](../development/code-structure.md)

---

**上一页**: [自定义提示词](custom-prompts.md)  
**下一页**: [最佳实践](best-practices.md)
