# 第一个建模任务

> **文档版本**: v2.0  
> **最后更新**: 2025-01-17  
> **预计时间**: 15 分钟

本指南将带您完成第一个数学建模任务，体验 MathModelAgent 的完整工作流程。

## 📋 前置条件

在开始之前，请确保：

- [x] 已完成[安装](installation.md)
- [x] 已完成[基础配置](basic-configuration.md)
- [x] 至少配置了一个 Agent 的 API Key
- [x] 系统正常运行（前端和后端都可访问）

## 🎯 学习目标

通过本教程，您将学会：

- 如何提交建模任务
- 如何上传数据文件
- 如何查看实时进度
- 如何获取建模结果
- 如何管理任务历史

## 🚀 方式一：运行内置示例（推荐）

最简单的方式是运行内置示例，无需准备数据。

### 步骤 1: 打开示例页面

1. 访问前端界面：http://localhost:5173
2. 点击左侧边栏的 **"示例"** 图标
3. 您将看到多个内置示例

### 步骤 2: 选择示例

示例列表：

**优化问题示例*[object Object] 线性规划问题
- 🎯 非线性优化
- 🔢 整数规划

**数据分析示例**:
- 📈 时间序列分析
- 🔍 聚类分析
- 📉 回归分析

**其他示例[object Object]优化
- 🎲 概率统计
-[object Object]数值计算

选择任意一个示例，点击 **"查看详情"**。

### 步骤 3: 启动任务

1. 查看示例的问题描述
2. 确认配置选项：
   - **竞赛模板**: 国赛 / 美赛
   - **输出格式**: Markdown / LaTeX
   - **语言**: 自动检测 / 中文 / 英文
3. 点击 **"开始建模"** 按钮

### 步骤 4: 观察实时进度

任务启动后，您将看到：

**进度指示器**:
```
[=====>    ] 50% - 正在执行代码...
```

**Agent 工作状态**:
- 🎯 **CoordinatorAgent**: 分析问题结构 ✓
- 🧮 **ModelerAgent**: 建立数学模型 ⏳
- [object Object]rAgent**: 编写代码...
- ✍️ **WriterAgent**: 等待中

**实时日志**:
```
[12:34:56] CoordinatorAgent: 问题分析完成
[12:35:12] ModelerAgent: 建立线性规划模型
[12:35:45] CoderAgent: 开始编写求解代码
[12:36:20] CoderAgent: 代码执行成功
```

### 步骤 5: 查看结果

任务完成后，您可以：

**1. 查看论文**:
- 点击 **"查看论文"** 标签
- 浏览生成的 Markdown 格式论文
- 下载 Word 格式（如果选择了 DOCX）

**2. 查看代码**:
- 点击 **"代码执行"** 标签
- 查看 Jupyter Notebook
- 查看代码执行结果和图表

**3. 下载文件**:
- 点击 **"文件"** 标签
- 下载所有生成的文件
- 或单独下载特定文件

## 📁 方式二：提交自定义任务

使用您自己的问题和数据。

### 步骤 1: 准备问题描述

创建一个文本文件 `problem.txt`，例如：

```text
某工厂生产 A、B 两种产品，每种产品需要经过加工、装配两道工序。

已知条件：
- A 产品：加工 2 小时，装配 1 小时，利润 300 元
- B 产品：加工 1 小时，装配 2 小时，利润 250 元
- 每天加工时间不超过 8 小时
- 每天装配时间不超过 10 小时

问题：
1. 如何安排生产计划使利润最大？
2. 最大利润是多少？
3. 如果增加 2 小时加工时间，利润增加多少？
```

### 步骤 2: 准备数据文件（可选）

如果有数据，准备数据文件：

**data.csv**:
```csv
产品,加工时间,装配时间,利润
A,2,1,300
B,1,2,250
```

**constraints.json**:
```json
{
  "加工时间限制": 8,
  "装配时间限制": 10
}
```

### 步骤 3: 提交任务

1. 访问前端界面首页
2. 在 **"问题描述"** 区域输入或粘贴问题
3. 点击 **"上传文件"** 按钮
4. 选择数据文件（支持多选）
5. 配置选项：
   - 竞赛模板：国赛
   - 输出格式：Markdown
   - 语言：自动检测
6. 点击 **"开始建模"** 按钮

### 步骤 4: 监控进度

与示例任务相同，观察实时进度和日志。

### 步骤 5: 处理错误（如果有）

如果代码执行失败：

**自动重试**:
- 系统会自动重试最多 5 次
- 每次重试会分析错误并修正代码

**查看错误信息**:
```
[错误] NameError: name 'np' is not defined
[重试 1/5] 正在修正代码...
[成功] 代码执行成功
```

**手动干预**:
- 如果多次重试失败，可以下载代码
- 手动修改后重新提交

## 📊 理解工作流程

### 完整流程图

```
用户提交问题
    ↓
CoordinatorAgent 分析问题
    ↓
ModelerAgent 建立数学模型
    ↓
CoderAgent 编写并执行代码
    ↓ (如果失败)
自动分析错误并重试 (最多 5 次)
    ↓ (成功后)
WriterAgent 撰写论文
    ↓
生成最终结果
```

### Agent 职责

**CoordinatorAgent（协调器）**:
- 分析问题类型
- 识别子问题
- 确定求解策略

**ModelerAgent（建模器）**:
- 建立数学模型
- 定义变量和约束
- 选择求解方法

**CoderAgent（编码器）**:
- 实现模型代码
- 执行计算
- 生成可视化
- 自动调试错误

**WriterAgent（写作器）**:
- 撰写论文各章节
- 整合结果和图表
- 引用相关文献
- 格式化输出

## 📁 输出文件说明

任务完成后，在 `backend/project/work_dir/{task_id}/` 目录下生成：

### 核心文件

**notebook.ipynb**:
- Jupyter Notebook 格式
- 包含所有代码和执行结果
- 可以重新编辑和运行

**res.md**:
- Markdown 格式的论文
- 包含完整的章节结构
- 可以转换为其他格式

**res.docx** (可选):
- Word 格式的论文
- 可直接提交或编辑

### 数据文件

**data/**:
- 您上传的原始数据
- 保持原有的目录结构

**figures/**:
- 生成的图表
- PNG 格式
- 自动嵌入论文中

### 统计文件

**token_usage.json**:
```json
{
  "CoordinatorAgent": {
    "prompt_tokens": 1000,
    "completion_tokens": 500,
    "total_tokens": 1500,
    "cost": 0.015
  },
  "total_cost": 0.125
}
```

**chat_completion.json**:
- 完整的对话记录
- 用于调试和分析

## 🎨 查看和编辑结果

### 在线查看

1. **论文预览**:
   - 支持 Markdown 渲染
   - 支持 LaTeX 公式
   - 支持图片显示

2. **代码查看**:
   - Notebook 单元格展示
   - 代码高亮
   - 输出结果展示

### 下载编辑

1. **下载单个文件**:
   - 点击文件名旁的下载图标
   - 选择保存位置

2. **下载所有文件**:
   - 点击 "下载全部" 按钮
   - 获得 ZIP 压缩包

3. **本地编辑**:
   - 使用 Jupyter 打开 `.ipynb`
   - 使用 Markdown 编辑器打开 `.md`
   - 使用 Word 打开 `.docx`

## 📜 管理任务历史

### 查看历史

1. 点击左侧边栏的 **"历史"** 图标
2. 查看所有任务列表
3. 筛选和排序：
   - 按类型：自定义 / 示例
   - 按状态：进行中 / 已完成 / 失败
   - 按时间：最新 / 最旧

### 收藏任务

1. 在任务卡片上点击 ⭐ 图标
2. 收藏的任务会置顶显示
3. 方便快速访问重要任务

### 重新运行

1. 打开历史任务
2. 点击 **"重新运行"** 按钮
3. 可以修改配置后重新提交

### 删除任务

1. 点击任务卡片的删除图标
2. 确认删除
3. 任务和所有文件将被删除

## 💡 使用技巧

### 提高成功率

1. **清晰的问题描述**:
   - 明确说明已知条件
   - 清楚列出要求解的问题
   - 提供必要的背景信息

2. **合适的数据格式**:
   - 使用 CSV 或 Excel 格式
   - 确保数据清洁和完整
   - 添加列标题说明

3. **选择合适的模型**:
   - Coordinator 用快速模型
   - Modeler 用强推理模型
   - Coder 用代码专用模型

### 优化性能

1. **使用示例作为模板**:
   - 参考示例的问题描述格式
   - 学习数据组织方式

2. **分步提交**:
   - 复杂问题可以分解为多个子问题
   - 逐步求解和验证

3. **利用历史结果**:
   - 相似问题可以参考历史任务
   - 复用成功的代码和方法

## ❓ 常见问题

### Q: 任务一直卡在某个阶段怎么办？

**A**:
1. 检查后端日志是否有错误
2. 确认 API Key 额度是否充足
3. 尝试刷新页面重新连接
4. 如果超过 5 分钟无响应，可以取消重试

### Q: 代码执行失败怎么办？

**A**:
1. 系统会自动重试最多 5 次
2. 查看错误日志了解失败原因
3. 如果是数据问题，检查数据格式
4. 如果是模型问题，尝试更换 Coder 模型

### Q: 生成的论文质量不满意？

**A**:
1. 尝试使用更强大的 Writer 模型
2. 提供更详细的问题描述
3. 在提示词模板中添加具体要求
4. 手动编辑生成的 Markdown 文件

### Q: 如何提高生成速度？

**A**:
1. 使用更快的模型（如 GPT-3.5）
2. 减少问题复杂度
3. 使用本地 Jupyter 而非云端 E2B
4. 确保网络连接稳定

## 📚 下一步

完成第一个任务后，您可以：

1. [学习文件上传](../guides/file-upload.md) - 掌握高级文件处理
2. [配置自定义模型](../guides/model-configuration.md) - 优化模型选择
3. [自定义提示词](../guides/custom-prompts.md) - 定制 Agent 行为
4. [查看最佳实践](../guides/best-practices.md) - 学习使用技巧

## 💬 获取帮助

遇到问题？

- [常见问题 FAQ](../faq/installation.md)
- [GitHub Issues](https://github.com/jihe520/MathModelAgent/issues)
- QQ 群：699970403 / 779159301
- Discord 社区

---

**上一页**: [基础配置](basic-configuration.md)  
**下一页**: [文件上传指南](../guides/file-upload.md)

**恭喜！*[object Object]经完成了第一个建模任务，开始探索 MathModelAgent 的更多功能吧！
